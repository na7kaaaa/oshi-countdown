<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>æ¨ã—æ´»ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³</title>
  <style>
    :root { --bg:#0b0f14; --card:#111827; --text:#e5e7eb; --muted:#9ca3af; --accent:#f472b6; }
    * { box-sizing: border-box; }
    body {
      margin: 0; padding: 16px;
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans JP", "Hiragino Kaku Gothic ProN", Meiryo, sans-serif;
      background: transparent;
      color: var(--text);
    }
    .wrap { max-width: 520px; margin: 0 auto; }
    .card {
      background: linear-gradient(180deg, rgba(244,114,182,.14), rgba(244,114,182,0)) , var(--card);
      border: 1px solid rgba(255,255,255,.08);
      border-radius: 18px;
      padding: 14px 14px 12px;
      box-shadow: 0 10px 30px rgba(0,0,0,.25);
    }
    .title { font-size: 13px; letter-spacing: .08em; color: var(--muted); margin-bottom: 10px; }
    .row {
      display: grid;
      grid-template-columns: 32px 1fr auto;
      gap: 10px;
      align-items: center;
      padding: 10px 10px;
      border-radius: 14px;
      background: rgba(255,255,255,.03);
    }
    .row + .row { margin-top: 10px; }
    .emoji { font-size: 20px; }
    .label { font-size: 14px; }
    .sub { display:block; font-size: 12px; color: var(--muted); margin-top: 2px; }
    .pill {
      font-variant-numeric: tabular-nums;
      padding: 6px 10px;
      border-radius: 999px;
      background: rgba(244,114,182,.16);
      border: 1px solid rgba(244,114,182,.25);
      color: #ffd1e8;
      font-size: 13px;
      white-space: nowrap;
    }
    .today { background: rgba(16,185,129,.16); border-color: rgba(16,185,129,.25); color: #b7ffdf; }
    .past { background: rgba(239,68,68,.16); border-color: rgba(239,68,68,.25); color: #ffd1d1; }
    .footer { margin-top: 10px; font-size: 11px; color: var(--muted); display:flex; justify-content: space-between; }
    button {
      appearance: none; border: 1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.04); color: var(--text);
      padding: 6px 10px; border-radius: 12px; cursor: pointer; font-size: 11px;
    }
    button:hover { background: rgba(255,255,255,.07); }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card" role="group" aria-label="æ¨ã—æ´»ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³">
      <div class="title">æ¨ã—æ´»ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆ</div>

      <div class="row">
        <div class="emoji">ğŸ‚</div>
        <div class="label">
          <span id="bLabel">æ¨ã—èª•ç”Ÿæ—¥</span>
          <span class="sub" id="bDateText">â€”</span>
        </div>
        <div class="pill" id="bCountdown">â€”</div>
      </div>

      <div class="row">
        <div class="emoji">ğŸ</div>
        <div class="label">
          <span id="eLabel">æ¬¡ã®ã‚¤ãƒ™ãƒ³ãƒˆ</span>
          <span class="sub" id="eDateText">â€”</span>
        </div>
        <div class="pill" id="eCountdown">â€”</div>
      </div>

      <div class="footer">
        <span id="nowText">â€”</span>
        <button id="editBtn" type="button">æ—¥ä»˜ã‚’å¤‰æ›´</button>
      </div>
    </div>
  </div>

  <script>
    // ====== ã“ã“ã‚’ç·¨é›†ã™ã‚‹ã ã‘ã§OK ======
    const CONFIG = {
      oshiname: "æ¨ã—",               // è¡¨ç¤ºå
      birthday: "2000-08-06",         // æ¨ã—ã®èª•ç”Ÿæ—¥ï¼ˆå¹´ã¯ä»®ã§OKï¼‰
      // birthdayMode:
      //  "next" = æ¬¡ã«æ¥ã‚‹èª•ç”Ÿæ—¥ã¾ã§ï¼ˆæ¯å¹´æ›´æ–°ï¼‰â†æ¨ã—èª•ãªã‚‰åŸºæœ¬ã“ã‚Œ
      //  "fixed" = æŒ‡å®šæ—¥ãã®ã‚‚ã®ã¾ã§ï¼ˆå¹´ã‚‚æ„å‘³ãŒã‚ã‚‹ã¨ãï¼‰
      birthdayMode: "next",

      nextEventName: "æ¬¡ã®è©¦åˆ",
      nextEventDate: "2026-01-05",    // æ¬¡ã‚¤ãƒ™ãƒ³ãƒˆæ—¥ï¼ˆYYYY-MM-DDï¼‰
      // ã‚¤ãƒ™ãƒ³ãƒˆãŒè¤‡æ•°ã‚ã‚‹ãªã‚‰é…åˆ—ã§ã‚‚OKï¼ˆæœ€çŸ­ã‚’è‡ªå‹•ã§é¸ã¶ï¼‰
      // nextEventDate: ["2026-01-05","2026-01-18"]

      locale: "ja-JP",
      timeZone: "Asia/Tokyo"
    };

    // ====== ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ ======
    const $ = (id) => document.getElementById(id);

    function parseYMD(ymd) {
      // timezoneã‚ºãƒ¬ã‚’é¿ã‘ã¦ã€Œæ­£åˆã€ã§æ‰±ã†ï¼ˆNotionåŸ‹ã‚è¾¼ã¿ã§ã‚‚å®‰å®šï¼‰
      const [y,m,d] = ymd.split("-").map(Number);
      return new Date(Date.UTC(y, m-1, d, 12, 0, 0));
    }

    function todayUTCNoon() {
      const now = new Date();
      // Tokyoã®ã€Œä»Šæ—¥ã€ã‚’åŸºæº–ã«ã—ãŸã„ã®ã§ã€Intlã§æ—¥ä»˜ã ã‘å–ã‚Šç›´ã™
      const parts = new Intl.DateTimeFormat(CONFIG.locale, {
        timeZone: CONFIG.timeZone,
        year: "numeric", month: "2-digit", day: "2-digit"
      }).formatToParts(now);
      const y = parts.find(p=>p.type==="year").value;
      const m = parts.find(p=>p.type==="month").value;
      const d = parts.find(p=>p.type==="day").value;
      return parseYMD(`${y}-${m}-${d}`);
    }

    function formatDate(ymd) {
      const dt = parseYMD(ymd);
      return new Intl.DateTimeFormat(CONFIG.locale, {
        timeZone: CONFIG.timeZone,
        year: "numeric", month: "long", day: "numeric", weekday: "short"
      }).format(dt);
    }

    function daysDiff(fromUTCNoon, toUTCNoon) {
      const ms = toUTCNoon - fromUTCNoon;
      return Math.round(ms / (1000 * 60 * 60 * 24));
    }

    function pickNearestEvent(dateOrArray, baseDateUTCNoon) {
      const list = Array.isArray(dateOrArray) ? dateOrArray : [dateOrArray];
      let best = null;
      for (const ymd of list) {
        const dt = parseYMD(ymd);
        const diff = daysDiff(baseDateUTCNoon, dt);
        if (diff >= 0 && (best === null || diff < best.diff)) best = { ymd, dt, diff };
      }
      // å…¨éƒ¨éå»ãªã‚‰ä¸€ç•ªè¿‘ã„éå»ã‚’è¡¨ç¤º
      if (!best) {
        let pastBest = null;
        for (const ymd of list) {
          const dt = parseYMD(ymd);
          const diff = daysDiff(baseDateUTCNoon, dt);
          if (pastBest === null || diff > pastBest.diff) pastBest = { ymd, dt, diff };
        }
        return pastBest;
      }
      return best;
    }

    function nextBirthday(birthdayYMD, baseDateUTCNoon) {
      const [_, mm, dd] = birthdayYMD.split("-").map(Number);
      // base ã®å¹´ï¼ˆTokyoä»Šæ—¥ï¼‰ã‚’ä½¿ã†
      const parts = new Intl.DateTimeFormat(CONFIG.locale, {
        timeZone: CONFIG.timeZone,
        year: "numeric"
      }).formatToParts(new Date());
      const yearNow = Number(parts.find(p=>p.type==="year").value);

      let target = new Date(Date.UTC(yearNow, mm-1, dd, 12, 0, 0));
      if (daysDiff(baseDateUTCNoon, target) < 0) {
        target = new Date(Date.UTC(yearNow + 1, mm-1, dd, 12, 0, 0));
      }
      const y = target.getUTCFullYear();
      const m = String(target.getUTCMonth()+1).padStart(2,"0");
      const d = String(target.getUTCDate()).padStart(2,"0");
      return { ymd: `${y}-${m}-${d}`, dt: target };
    }

    function setPill(el, diff) {
      el.classList.remove("today","past");
      if (diff === 0) { el.textContent = "ğŸ‰ ä»Šæ—¥ï¼"; el.classList.add("today"); }
      else if (diff > 0) { el.textContent = `ã‚ã¨ ${diff}æ—¥`; }
      else { el.textContent = `${Math.abs(diff)}æ—¥ çµŒé`; el.classList.add("past"); }
    }

    function render() {
      const base = todayUTCNoon();

      // labels
      $("bLabel").textContent = `æ¨ã—èª•ç”Ÿæ—¥ï¼ˆ${CONFIG.oshiname}ï¼‰`;
      $("eLabel").textContent = CONFIG.nextEventName;

      // birthday target
      const bTarget = (CONFIG.birthdayMode === "fixed")
        ? { ymd: CONFIG.birthday, dt: parseYMD(CONFIG.birthday) }
        : nextBirthday(CONFIG.birthday, base);

      $("bDateText").textContent = formatDate(bTarget.ymd);
      setPill($("bCountdown"), daysDiff(base, bTarget.dt));

      // event target
      const ev = pickNearestEvent(CONFIG.nextEventDate, base);
      $("eDateText").textContent = formatDate(ev.ymd);
      setPill($("eCountdown"), ev.diff);

      // now footer
      const now = new Date();
      $("nowText").textContent =
        "æ›´æ–°: " +
        new Intl.DateTimeFormat(CONFIG.locale, {
          timeZone: CONFIG.timeZone,
          year: "numeric", month: "2-digit", day: "2-digit",
          hour: "2-digit", minute: "2-digit"
        }).format(now);
    }

    function quickEdit() {
      const b = prompt("æ¨ã—ã®èª•ç”Ÿæ—¥ã‚’ YYYY-MM-DD ã§å…¥åŠ›ï¼ˆå¹´ã¯ä»®ã§OKï¼‰", CONFIG.birthday);
      if (b) CONFIG.birthday = b.trim();

      const e = prompt("æ¬¡ã‚¤ãƒ™ãƒ³ãƒˆæ—¥ã‚’ YYYY-MM-DDï¼ˆè¤‡æ•°ãªã‚‰ã‚«ãƒ³ãƒåŒºåˆ‡ã‚Šï¼‰", Array.isArray(CONFIG.nextEventDate) ? CONFIG.nextEventDate.join(",") : CONFIG.nextEventDate);
      if (e) {
        const arr = e.split(",").map(s=>s.trim()).filter(Boolean);
        CONFIG.nextEventDate = arr.length > 1 ? arr : arr[0];
      }

      render();
    }

    $("editBtn").addEventListener("click", quickEdit);

    render();
    // 1æ™‚é–“ãŠãã«æ›´æ–°ï¼ˆNotionåŸ‹ã‚è¾¼ã¿ã§ã‚‚OKï¼‰
    setInterval(render, 60 * 60 * 1000);
  </script>
</body>
</html>
